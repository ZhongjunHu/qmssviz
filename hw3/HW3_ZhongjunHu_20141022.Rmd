---
title: "ZhongjunHu_hw3_20141022"
author: "Zhongjun Hu (UNI:zh2223)"
---
##Income Equality in China, Japan, and South Korea (1990 & 2012)

###A. Identify two surveys that you want to compare.

I am interested in the issues of income distribution in Asia in the past 20 years. China, Japan, and South Korea are top 3 prosperous countries in east Asia. So I choose the 3 countries to analyze what I am interested in. 

Two waves from World Values Survey are selected, wave 6 (2010-2014) and wave 2 (1990-1994). I intend to find out what changes of people's feelings about social equality have happened in the 20 years.

The question about income equality in those 2 waves are almost the same: 

      "Now I'd like you to tell me your views on various issues. How would you place your views on this scale? 1 means you agree completely with the statement on the left; 10 means you agree completely with the statement on the right; and if your views fall somewhere in between, you can choose any number in between 'Incomes should be made more equal' vs. 'We need larger income differences as incentives for individual effort'".
      
For instance, if one really thought that incomes should be made more equal, and gave a score of 1 or 2, it probably demonstrated that the income inequality at that time was really severe, vice versa. Thus, we could find out the changes of the social equality from the answers of respondents.

##B. Sketch and/or describe the graph(s) 

I want to plot 3 pictures.

The first one is a group of 3 histogram plots of the answers in each country, in each of which there are two lines labeling different waves of 1990 and 2000.

The second is a segment-point plot. X-axis is "country" and Y-axis is the mean of each country. There are two segments above each country to indicate the mean value in different waves, namely the year of 1990 and 2000. This one is designed to demonstrate the comparison of average level of 2 waves in each country. 

The last one is a bar graph. X-axis is "answer scale"", which contains "1" to "10". Y-axis is "percentage", which means the percentage of frequency of an answer (like "5") in the total sum of answers in a country in one wave. Above the X-axis is the "percentage" in the year of 1990, while beneath the X-axis is "percentage" in the year of 2012. This is designed to show the changes in each answer.

##### #I tried to import my sketch but failed.Below are the Error and warnings, when I tried "library(Cairo)" and importing jpg :
      Error : .onLoad failed in loadNamespace() for 'Cairo', details:call: dyn.load(file, DLLpath = DLLpath, ...)error: unable to load shared object '/Library/Frameworks/R.framework/Versions/3.1/Resources/library/Cairo/libs/Cairo.so':dlopen(/Library/Frameworks/R.framework/Versions/3.1/Resources/library/Cairo/libs/Cairo.so, 6): Library not loaded: /opt/X11/lib/libXrender.1.dylib.Referenced from: /Library/Frameworks/R.framework/Versions/3.1/Resources/library/Cairo/libs/Cairo.so Reason: image not found. Error: package or namespace load failed for 'Cairo'
```{r}
#Not able to library(Cairo)#
jpeg("/Users/huzhongjun/Downloads/IMG_2706.jpg")
```

##C. Write down the target shape

I would like to select data about the same question from two waves of survey.

In my target shape of data, I would like to include the year of two waves, 3 countries:China, Japan, South Korea, all the answers ("1" to "10"), average scores to this questions of 2 waves in each countries:

      {Year:"1990, 2012", Country:"China, Japan, South Korea", Mean(c("Country, Year"), Values of Income Equality("1~10")}

##D. Write a script

```{r,warning=FALSE}
#Read 2 datasets about China from WVS Database#
library(foreign)
wv2cn<-read.spss("/Users/huzhongjun/Desktop/HW3/WV2_Data_China_1990_spss_v_2014_04_28.sav",to.data.frame = TRUE)
wv6cn<-read.spss("/Users/huzhongjun/Desktop/HW3/WV6_Data_China_2012_spss_v_2014_04_28.sav",to.data.frame = TRUE)

#Get variables of Income Equality#
eqin1<-subset(wv2cn, select = c("v2","v250"))
eqin2<-subset(wv6cn, select = c("V2","V96"))

#Trasform and merge#
eqin1990<-cbind(year=1990, eqin1)
eqin2012<-cbind(year=2012,eqin2)
library(plyr)
eqin1990<-rename(eqin1990, c("v2"="Country","v250"="IncomeEquality"))
eqin2012<-rename(eqin2012, c("V2"="Country","V96"="IncomeEquality"))
incomeequalitycn<-rbind(eqin1990, eqin2012)

#Read 2 datasets about Japan from WVS Database#
wv2jp<-read.spss("/Users/huzhongjun/Desktop/HW3/WV2_Data_Japan_1990_spss_v_2014_04_28.sav",to.data.frame = TRUE)
wv6jp<-read.spss("/Users/huzhongjun/Desktop/HW3/WV6_Data_Japan_2010_spss_v_2014_04_28.sav",to.data.frame = TRUE)

#Get Variables of Income Equality, transform them and merge#
eqin1jp<-subset(wv2jp,select=c("v2","v250"))
eqin1990jp<-cbind(year=1990,eqin1jp)
eqin1990jp<-rename(eqin1990jp,c("v2"="Country","v250"="IncomeEquality"))
eqin2jp<-subset(wv6jp,select=c("V2","V96"))
eqin2012jp<-cbind(year=2012,eqin2jp)
eqin2012jp<-rename(eqin2012jp,c("V2"="Country","V96"="IncomeEquality"))
incomeequalityjp<-rbind(eqin1990jp,eqin2012jp)

#Read 2 databases about South Korea from WVS Database#
wv2sk<-read.spss("/Users/huzhongjun/Desktop/HW3/WV2_Data_SouthKorea_1990_spss_v_2014_04_28.sav",to.data.frame = TRUE)
wv6sk<-read.spss("/Users/huzhongjun/Desktop/HW3/WV6_Data_South_Korea_2010_spss_v_2014_04_28.sav",to.data.frame = TRUE)

#Get Variables of Income Equality, transform them and merge#
eqin1sk<-subset(wv2sk,select=c("v2","v250"))
eqin2sk<-subset(wv6sk,select=c("V2","V96"))
eqin1990sk<-cbind(year=1990,eqin1sk)
eqin2012sk<-cbind(year=2012,eqin2sk)
eqin1990sk<-rename(eqin1990sk,c("v2"="Country","v250"="IncomeEquality"))
eqin2012sk<-rename(eqin2012sk,c("V2"="Country","V96"="IncomeEquality"))
incomeequalitysk<-rbind(eqin1990sk,eqin2012sk)

#Merge dataframes of 3 countries and clean the NAs#
cjkinceq<-rbind(incomeequalitycn,incomeequalityjp,incomeequalitysk)
d<-cjkinceq
df<-na.omit(d)

#Get the target dataframe#
df$iechr<-as.character(df$IncomeEquality)
df$ie[df$iechr=="Individ"]<- "Very Equal"
df$ie[df$iechr=="Equal"]<- "Very Inequal"
df$ie[df$iechr=="Incomes should be made more equal"]<- "Very Inequal"
df$ie[df$iechr=="We need larger income differences as incentives for individu"]<- "Very Equal"
df$ie[df$iechr=="2"]<- "Very Inequal"
df$ie[df$iechr=="3"]<- "Inequal"
df$ie[df$iechr=="4"]<- "Inequal"
df$ie[df$iechr=="5"]<- "Totally neutral about that"
df$ie[df$iechr=="6"]<- "Totally neutral about that"
df$ie[df$iechr=="7"]<- "Equal"
df$ie[df$iechr=="8"]<- "Equal"
df$ie[df$iechr=="9"]<- "Very Equal"

df$Index[df$iechr=="Individ"]<- 10
df$Index[df$iechr=="Equal"]<- 1
df$Index[df$iechr=="Incomes should be made more equal"]<- 1
df$Index[df$iechr=="We need larger income differences as incentives for individu"]<- 10
df$Index[df$iechr=="2"]<- 2
df$Index[df$iechr=="3"]<- 3
df$Index[df$iechr=="4"]<- 4
df$Index[df$iechr=="5"]<- 5
df$Index[df$iechr=="6"]<- 6
df$Index[df$iechr=="7"]<- 7
df$Index[df$iechr=="8"]<- 8
df$Index[df$iechr=="9"]<- 9
library(data.table)
dmean <- aggregate(df$Index, by = list(df$Country, df$year), mean)
dmean <- rename(dmean,c("Group.1"="Country", "Group.2"= "year", "x"= "Mean")) #Get the means#
dp <- data.table(df)
dp <- dp[, list(ie = unique(ie), percentage = as.numeric(table(ie)/length(ie))), by = c("year", "Country")] #Get percentages#
```

##E. Make it actually make your graph. 

"1" means that a person totally agreed that in this society income should be more equal, which shows that he or she thought at that time the society was not equal. So the lower the score is, the more serious inequality of income is. "10" means the opposite situation that the social welfare was so good that we need some differences in income to make people work harder!

To make the second plot more readable, I reagrrange the results of answers of respondents into 5 levels:

First: "1" and "2" are labeled as "very inequal"; 
Secound: "3" and "4" are labeled as "inequal"; 
Third: "5" and "6" are labeled as "Totally neutral about that"; 
Fourth: "7" and "8" are "equal"; 
Fifth: "9" and "10" are "very equal"

We can see the changes in those 3 pictures below, the means, percentage, and the sum total. It is easy to compare them together. For example, the level of income equality in China has delined quite a lot in the past 20 years, from nearly 8 to almost 4. But South Korea is totally the opposite. Japan has not changed a lot. The result could be explained by the development in those 3 countries. China has developed dramatically in recent decades. Along with the increasing wealths, problems of income distribution are very commom around the world. In constrast with Japan, the economy in Japan is relatively stable. The growth is slow, so is the changes of wealth distribution. South Korea had suffered from the financial crisis twince in recent 14 years, during which people were more sensitive to the recovery of economy rather than income equality.

```{r,fig.height=7,fig.width=12}
library(ggplot2)
ggplot(dmean, aes(x= Mean, y= Country)) +
        geom_segment(stat="identity",aes(yend=Country), xend = 0, colour="black") +
        geom_point(size=3.5, aes(colour=factor(year))) +
        scale_colour_brewer(palette="Set1", guide=FALSE) +
        theme_bw() +
        theme(panel.grid.major.y = element_blank(),
              panel.grid.minor.x = element_blank(),
              panel.grid.major.x = element_line(colour = "grey", linetype="dashed")) +
        facet_grid(year ~ ., scales="free_y", space="free_y")+
        ggtitle("Average Level of Each Country")

library(RColorBrewer)
color <- brewer.pal(5, "Greens")
ggplot(dp, aes(x=Country, y= percentage,fill=ie))+
  geom_bar(stat= "identity",position="dodge")+
  facet_grid(year ~. )+
  theme_bw() +
  theme(panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(colour="white", linetype="dashed"))+
  guides(fill=guide_legend(title=NULL))+
  scale_fill_manual(values=color)+
  ggtitle("Income Equality: Percentage of Each level")

ggplot(df, aes(x = Country, fill=as.character(Index)))+geom_bar(position="dodge")+
  facet_grid(year ~ .)+
  theme_bw() +
  theme(panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(colour="white", linetype="dashed"))+
   ggtitle("Income Equality: Sums of Each level")+
    guides(fill=guide_legend(title=NULL))
  
  
```
      
      1. The first group of plots in my mind, as I mentioned in step B, is so annoying for read and difficult to plot, thus I abandoned them
      2. I think there are some bugs in my second and third graphs, but I cannot find out what goes wrong. In the second graph, the distribtion doesn't match with the result in the first and third graph very well. I think the order of labels is not consistent. In the third graph, the guide in the right is strange that "10" ranks in the second order. Anyone could help me?

##F. Write expressive fantasy function calls

```{r,eval=FALSE}
#Choose 6 datasets, 3 countries from 2 waves#
1990 <- read.data.in1990(china1990, japan1990, southkorea1990)
2012 <- read.data.in2012(china2012, japan2012, southkorea2012)

#Select the variable of income equality from both waves#
1990 <- selectvariable(1990)
2012 <- selectvariable(2012)

#Transform the dataframes, ready for merging#
1990 <- data.transform(1990)
2012 <- data.transform(2012)

#Merge 2 waves into a single dataframe#
incomeequality <- d.merge(1990,2012)

#Calculate the percentage and other statistics#
df <- calculate(incomeequality)

#Plot#
ggplot(df, aes()...) + ...

```

##G. (Bonus) Write (some or all of) the functions to read, transform, and analyze the data.
```{r}
ReadData <- function(route) {
  read.spss(route)
}

Subset <- function(data, var1, var2){
  subset(data, select = c(var1, var2))
}

Merge <- function(df1,df2){
  rbind(df1,df2)
}
```
